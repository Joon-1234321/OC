<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì¤‘ì•™ ë°˜ì§ â†’ íƒ€ì´í•‘ ìŠ¤í”¼ë“œì—… ë§¤ì¹­ (ì •ë‹µ ë…¸ì¶œ í›„ ë”°ë¼ì¹˜ê¸°)</title>
<style>
  :root{--bg:#0b1220;--panel:#0f1b36cc;--ink:#eaf0ff;--accent:#4ea1ff;--accent2:#00c2a8;--ok:#22c55e;--no:#ef4444}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:radial-gradient(1000px 600px at 50% -10%,#162750 0%,var(--bg) 60%);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto}
  .shell{max-width:1100px;margin:0 auto;padding:18px}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  h1{margin:0;font-size:clamp(18px,3vw,26px);font-weight:900}
  .hud{display:flex;gap:10px;flex-wrap:wrap}
  .pill{background:var(--panel);border:1px solid #28406e;padding:8px 12px;border-radius:999px;font-weight:800}
  .btn{cursor:pointer;background:#0e1a33;border:1px solid #28406e;color:var(--ink);padding:10px 14px;border-radius:12px;font-weight:800}
  .stage{position:relative;height:min(58vh,520px);border:1px solid #20345f;border-radius:18px;background:linear-gradient(180deg,#0e1a33,#0a1328);box-shadow:0 10px 30px #0005;display:flex;align-items:center;justify-content:center;overflow:hidden}
  .token{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);padding:12px 22px;border-radius:999px;font-weight:900;font-size:clamp(22px,4.6vw,44px);box-shadow:0 12px 28px #0006;border:1px solid #27457a;white-space:nowrap;text-align:center;z-index:5;opacity:1;visibility:visible;display:none}
  .token.en{background:linear-gradient(180deg,#ffffff0e,#337dff33);color:#cfe2ff}
  .token.ko{background:linear-gradient(180deg,#ffffff0e,#00c2a833);color:#d9fff7}
  .sparkle{animation:sparkle 1.1s ease-in-out infinite}
  @keyframes sparkle{0%{filter:brightness(1) drop-shadow(0 0 0 #4ea1ff66)}50%{filter:brightness(1.25) drop-shadow(0 0 16px #4ea1ff99)}100%{filter:brightness(1) drop-shadow(0 0 0 #4ea1ff66)}}
  .sparkle2{animation:sparkle2 1.1s ease-in-out infinite}
  @keyframes sparkle2{0%{filter:brightness(1) drop-shadow(0 0 0 #00c2a866)}50%{filter:brightness(1.25) drop-shadow(0 0 16px #00c2a899)}100%{filter:brightness(1) drop-shadow(0 0 0 #00c2a866)}}
  .panel{background:var(--panel);border:1px solid #28406e;border-radius:14px;padding:12px;margin-top:12px}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  .in{flex:1 1 300px;min-width:220px;padding:12px;border-radius:10px;border:1px solid #2b4677;background:#0b1a33;color:#fff;font-size:18px;font-weight:800}
  .hint{color:#aab8dd;font-size:14px;margin-top:6px}
  .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:20px;background:#0b162ecc;border:1px solid #24407a;padding:10px 14px;border-radius:12px;display:none}
  .flashOk{animation:flashOk .7s ease-out}
  @keyframes flashOk{0%{box-shadow:0 0 0px #22c55e}50%{box-shadow:0 0 26px #22c55e}100%{box-shadow:0 0 0px #22c55e}}
  .flashBad{animation:flashBad .7s ease-out}
  @keyframes flashBad{0%{box-shadow:0 0 0px #ef4444}50%{box-shadow:0 0 26px #ef4444}100%{box-shadow:0 0 0px #ef4444}}
</style>
</head>
<body>
<div class="shell">
<header>
<h1>ì¤‘ì•™ ë°˜ì§ â†’ íƒ€ì´í•‘ ìŠ¤í”¼ë“œì—… ë§¤ì¹­</h1>
<div class="hud">
  <div class="pill">ë¼ìš´ë“œ <b id="round">ENâ†’KO</b></div>
  <div class="pill">ì •ë‹µ <b id="score">0</b></div>
  <div class="pill">ì—°ì† <b id="streak">0</b></div>
  <div class="pill">í‘œì‹œì‹œê°„ <b id="spd">â€”</b></div>
  <button class="btn" id="btnRestart">â†» ë‹¤ì‹œí•˜ê¸°</button>
</div>
</header>
<section class="stage" id="stage">
  <div id="token" class="token en sparkle">train</div>
</section>
<div class="panel">
  <form id="form" class="row" autocomplete="off">
    <input id="ans" class="in" type="text" placeholder="ëœ»ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê¸°ì°¨)" />
    <button class="btn" type="submit">í™•ì¸</button>
  </form>
  <div class="hint" id="hint">ì˜¤ë‹µ 2íšŒ ì‹œ ì •ë‹µì„ ë³´ì—¬ì£¼ê³ , ê·¸ ì •ë‹µì„ ì§ì ‘ ì…ë ¥í•˜ë©´ ë„˜ì–´ê°‘ë‹ˆë‹¤.</div>
</div>
</div>
<div id="toast" class="toast"></div>
<script>
const WORDS=[
  {en:"train",ko:["ê¸°ì°¨","í›ˆë ¨í•˜ë‹¤"]},{en:"smile",ko:["ë¯¸ì†Œì§“ë‹¤"]},{en:"happily",ko:["í–‰ë³µí•˜ê²Œ"]},
  {en:"give up",ko:["í¬ê¸°í•˜ë‹¤"]},{en:"give in",ko:["êµ´ë³µí•˜ë‹¤","ì–‘ë³´í•˜ë‹¤"]},{en:"never",ko:["ì ˆëŒ€ ~ì•Šë‹¤"]},
  {en:"move",ko:["ì›€ì§ì´ë‹¤","ê°ë™ì‹œí‚¤ë‹¤"]},{en:"win",ko:["ì´ê¸°ë‹¤"]},{en:"return",ko:["ëŒì•„ì˜¤ë‹¤","ë˜ëŒë ¤ì£¼ë‹¤"]},
  {en:"abroad",ko:["í•´ì™¸ì—","í•´ì™¸ë¡œ"]},{en:"appear",ko:["ë‚˜íƒ€ë‚˜ë‹¤","ì¶œí˜„í•˜ë‹¤","ë³´ì´ë‹¤"]},
  {en:"Germany",ko:["ë…ì¼"]},{en:"always",ko:["í•­ìƒ"]},
  {en:"went",ko:["ê°”ë‹¤ (goì˜ ê³¼ê±°)","ê°”ë‹¤","goì˜ ê³¼ê±°","ê°€ë‹¤ì˜ ê³¼ê±°"]}
];

let phase='en2ko', list=[], idx=0, score=0, streak=0;
let showMs=5000, missTO=null, submitting=false, missCount=0;
let forceAnswer=null; // ì •ë‹µ ë…¸ì¶œ í›„ ë”°ë¼ì¹˜ê¸° ëª¨ë“œì¼ ë•Œ ìš”êµ¬í•˜ëŠ” ì •ë‹µ(ë¬¸ìì—´)

const $=s=>document.querySelector(s);
const stage=$('#stage'), token=$('#token'), form=$('#form'), ans=$('#ans');
const roundE=$('#round'), scoreE=$('#score'), streakE=$('#streak'), spdE=$('#spd');
const restartBtn=$('#btnRestart');
const toast=$('#toast');
const hint=$('#hint');

function toastMsg(m,ms=900){ toast.textContent=m; toast.style.display='block'; setTimeout(()=>toast.style.display='none',ms); }
function speak(t){ try{ const u=new SpeechSynthesisUtterance("\u200B,\u200B "+t); u.lang='en-US'; u.rate=.9; speechSynthesis.cancel(); speechSynthesis.speak(u);}catch(e){} }
const shuffle=a=>a.sort(()=>Math.random()-0.5);
const normEn=s=>s.toLowerCase().replace(/[^a-z ]/g,'').trim();
const normKo=s=>(s||'').toLowerCase().replace(/[()\[\]{}:;,.Â·ï¼Œã€ï¼ãƒ»]/g,'').replace(/\s+/g,'').trim();
const anyKoHit=(user,arr)=>{const u=normKo(user);const v=[];(arr||[]).forEach(k=>{const b=normKo(k);if(b)v.push(b);String(k).split(/[ï¼Œ,]/).forEach(p=>{const q=normKo(p.replace(/[()]/g,''));if(q)v.push(q);});});return v.some(x=>x&&x===u);};

function updateHUD(){ roundE.textContent=(phase==='en2ko')?'ENâ†’KO':'KOâ†’EN'; scoreE.textContent=score; streakE.textContent=streak; spdE.textContent=(showMs/1000).toFixed(1)+'s'; }
function buildList(){ list=shuffle([...WORDS]); idx=0; updateHUD(); }

function spawn(){
  clearTimeout(missTO); submitting=false; missCount=0; forceAnswer=null;
  const item=list[idx]; if(!item) return;
  const isEn=(phase==='en2ko');
  token.textContent = isEn ? item.en : (Array.isArray(item.ko)? item.ko[0] : item.ko);
  token.className = 'token ' + (isEn ? 'en sparkle' : 'ko sparkle2');
  token.style.display='block';
  ans.value=''; ans.placeholder = isEn ? 'ëœ»ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ê¸°ì°¨)' : 'ì˜ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: train)';
  if(isEn) speak(item.en);
  ans.focus();
  missTO=setTimeout(onMiss, showMs);
}

function onMiss(){
  // ì‹œê°„ ì´ˆê³¼ - ê°™ì€ ë¬¸ì œ ìœ ì§€
  stage.classList.add('flashBad'); setTimeout(()=>stage.classList.remove('flashBad'),400);
  toastMsg(forceAnswer? 'ì •ë‹µì´ ë³´ì˜€ì£ ? ê·¸ëŒ€ë¡œ ì…ë ¥í•´ ë³´ì„¸ìš”' : 'ì‹œê°„ ì´ˆê³¼! ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”');
  // ë”°ë¼ì¹˜ê¸° ëª¨ë“œì¼ ë•ŒëŠ” íƒ€ì´ë¨¸ ì •ì§€, ì•„ë‹ˆë©´ ì™„í™”í•˜ì—¬ ì¬ì‹œì‘
  if(!forceAnswer){
    showMs=Math.min(9000,Math.round(showMs*1.08));
    clearTimeout(missTO); missTO=setTimeout(onMiss, showMs);
  }
}

function revealCorrect(){
  const item=list[idx]; const isEn=(phase==='en2ko');
  // í‘œì‹œìš© ì •ë‹µ(ëŒ€í‘œí˜•): en2ko â†’ ì²« ë²ˆì§¸ í•œêµ­ì–´, ko2en â†’ ì˜ì–´
  forceAnswer = isEn ? (Array.isArray(item.ko)? item.ko[0] : item.ko) : item.en;
  clearTimeout(missTO); // íƒ€ì´ë¨¸ ì •ì§€
  // ì•ˆë‚´
  toastMsg(`ì •ë‹µ: ${forceAnswer}  â†’ ê·¸ëŒ€ë¡œ ì…ë ¥í•´ ë³´ì„¸ìš”`, 1400);
  ans.value=''; ans.placeholder = `ì •ë‹µì„ ê·¸ëŒ€ë¡œ ì…ë ¥: ${forceAnswer}`;
  ans.focus();
}

function onHit(){
  showMs=Math.max(1800,Math.round(showMs*0.95));
  score++; streak++; updateHUD();
  stage.classList.add('flashOk'); toastMsg('ì •ë‹µ! ğŸ‘',500);
  setTimeout(()=>{ stage.classList.remove('flashOk'); next(); }, 0);
}

function next(){
  idx++;
  if(idx>=list.length){
    if(phase==='en2ko'){
      phase='ko2en'; showMs=Math.min(9000,Math.max(3000,Math.round(showMs*1.15)));
      toastMsg('ëœ» â†’ ì˜ì–´ ë¼ìš´ë“œ ì‹œì‘!'); buildList(); spawn();
    }else{
      toastMsg(`ğŸ‰ ì™„ë£Œ! ì´ ì •ë‹µ ${score}ê°œ`,1500);
      stage.classList.add('flashOk'); setTimeout(()=>stage.classList.remove('flashOk'),700);
      token.style.display='none';
    }
  }else{ spawn(); }
}

form.addEventListener('submit', e=>{
  e.preventDefault();
  if(submitting) return; submitting=true;
  clearTimeout(missTO);
  if(!list[idx]){ submitting=false; return; }
  const item=list[idx]; const isEn=(phase==='en2ko');
  const val=ans.value.trim(); ans.value='';

  if(forceAnswer){
    // ë”°ë¼ì¹˜ê¸° ëª¨ë“œ: ë³´ì—¬ì¤€ ì •ë‹µì„ ì •í™•íˆ ì…ë ¥í•´ì•¼ í†µê³¼
    const ok = isEn ? anyKoHit(val, [forceAnswer]) : (normEn(val)===normEn(forceAnswer));
    if(ok){ onHit(); }
    else{
      toastMsg('í‘œì‹œëœ ì •ë‹µ ê·¸ëŒ€ë¡œ ì…ë ¥í•˜ì„¸ìš”');
      submitting=false; // ê³„ì† ì‹œë„ ê°€ëŠ¥
    }
    return;
  }

  if(isEn){
    if(anyKoHit(val,item.ko)) onHit();
    else {
      missCount++;
      if(missCount>=2){
        revealCorrect(); // ì •ë‹µ ë…¸ì¶œ í›„ ë”°ë¼ì¹˜ê¸° ëª¨ë“œ ì§„ì…
        submitting=false; // ê³„ì† ì…ë ¥ ê°€ëŠ¥
      }else{
        toastMsg('ë‹¤ì‹œ ì‹œë„!'); submitting=false; missTO=setTimeout(onMiss, Math.min(1200, showMs));
      }
    }
  }else{
    if(normEn(val)===normEn(item.en)) onHit();
    else {
      missCount++;
      if(missCount>=2){
        revealCorrect();
        submitting=false;
      }else{
        toastMsg('ë‹¤ì‹œ ì‹œë„!'); submitting=false; missTO=setTimeout(onMiss, Math.min(1200, showMs));
      }
    }
  }
});

restartBtn.addEventListener('click', reset);
function reset(){ speechSynthesis.cancel(); clearTimeout(missTO); token.style.display='none'; phase='en2ko'; score=0; streak=0; showMs=5000; missCount=0; forceAnswer=null; buildList(); requestAnimationFrame(()=>spawn()); }

function init(){ try{ reset(); }catch(e){ setTimeout(reset, 50); } }
if(document.readyState==='loading'){ document.addEventListener('DOMContentLoaded', init); } else { init(); }
window.addEventListener('load', ()=>{ setTimeout(()=>{ if(!list.length || token.style.display==='none' || !token.textContent){ reset(); } }, 100); });
</script>
</body>
</html>

