<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ì‘ íƒ€ì´í•‘</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 30px; line-height: 1.6; }
    h1 { margin-top: 0; }
    #question { font-size: 1.35em; margin: 18px 0; }
    input { font-size: 1.1em; padding: 8px 10px; width: 480px; max-width: 92vw; }
    button { font-size: 1.05em; padding: 8px 14px; margin: 10px 6px; cursor: pointer; }
    #feedback { margin-top: 10px; font-size: 1.05em; font-weight: 700; min-height: 1.6em; }
    #progress { margin-top: 6px; font-size: 0.95em; color: #555; }
    #attempts { margin-top: 6px; font-size: 0.95em; color: #a33; }
    #answersBox { margin: 12px auto 0; padding: 12px; max-width: 720px; border: 1px dashed #bbb; display: none; background: #fafafa; text-align: left; }
    #answersBox h3 { margin: 0 0 6px 0; font-size: 1.0em; }
    #answersBox ul { margin: 6px 0 0 1.1em; }
    #answersBox li { margin: 4px 0; }
    .wrap { max-width: 820px; margin: 0 auto; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ì˜ì‘ íƒ€ì´í•‘</h1>
    <div id="question"></div>
    <input type="text" id="answer" placeholder="ì˜ì–´ë¡œ ì…ë ¥í•˜ì„¸ìš”" autocomplete="off" autofocus />
    <div>
      <button id="checkBtn">ì •ë‹µ í™•ì¸</button>
      <button id="clearBtn">ì§€ìš°ê¸°</button>
      <button id="revealBtn" class="hidden">ì •ë‹µ ë³´ê¸°</button>
    </div>
    <div id="feedback"></div>
    <div id="attempts"></div>
    <div id="progress"></div>

    <div id="answersBox">
      <h3>í—ˆìš©ë˜ëŠ” ì •ë‹µ(ì˜ˆì‹œ)</h3>
      <ul id="answersList"></ul>
      <div style="margin-top:6px;color:#555;">â€» ìœ„ í‘œí˜„ ì¤‘ í•˜ë‚˜ë¥¼ <b>ì…ë ¥ì°½ì— ê·¸ëŒ€ë¡œ ì…ë ¥</b>í•´ì„œ ì •ë‹µ ì²˜ë¦¬ í›„ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°€ì„¸ìš”.</div>
    </div>
  </div>

  <script>
    /**************** ì„¤ì • ****************/
    const MAX_WRONG = 3;     // ì˜¤ë‹µ í—ˆìš© íšŸìˆ˜
    const ALLOW_FUZZY = true;
    const FUZZY_DISTANCE = 1; // ì˜¤íƒ€ í—ˆìš© ê¸€ì ìˆ˜(í¸ì§‘ê±°ë¦¬)

    // ë¬¸ì œ & ì •ë‹µ(ì—¬ëŸ¬ ë³€í˜• í—ˆìš©) â€“ ë§ˆì¹¨í‘œ ì—†ì´ ì €ì¥ (ë¹„êµ ì‹œ ë¬¸ì¥ë¶€í˜¸ ì œê±°)
    const quiz = [
      { q: "ë¬¸ì œ1. ë‚˜ì˜ í•™êµëŠ” 9ì‹œì— ì‹œì‘í•œë‹¤.",
        a: [
          "my school begins at 9 o'clock",
          "my school begins at 9",
          "my school begins at nine o'clock",
          "my school begins at nine"
        ]},
      { q: "ë¬¸ì œ2. ë‚˜ëŠ” 7ì‹œì— ì¼ì–´ë‚œë‹¤.",
        a: [
          "i wake up at 7 o'clock",
          "i wake up at 7",
          "i wake up at seven o'clock",
          "i wake up at seven"
        ]},
      { q: "ë¬¸ì œ3. ë‚˜ëŠ” ë§¤ì¼ í•™êµì— ê°„ë‹¤.",
        a: ["i go to school every day"]},
      { q: "ë¬¸ì œ4. ê·¸ëŠ” ì•„ì¹¨ì— í•™êµë¡œ ê±¸ì–´ê°„ë‹¤.",
        a: ["he walks to school in the morning"]},
      { q: "ë¬¸ì œ5. ê·¸ë…€ëŠ” ìš´ë™ì¥ì—ì„œ ë‹¬ë¦°ë‹¤.",
        a: ["she runs on the playground"]},
      { q: "ë¬¸ì œ6. ê·¸ ìˆ˜ì—…ì€ 12ì‹œì— ëë‚œë‹¤.",
        a: [
          "the class ends at 12 o'clock",
          "the class ends at 12",
          "the class ends at twelve o'clock",
          "the class ends at twelve"
        ]},
      { q: "ë¬¸ì œ7. ë‚˜ëŠ” ì˜¤ëŠ˜ ëŠ¦ê²Œ ì¼ì–´ë‚¬ë‹¤.",
        a: ["i woke up late today"]},
      { q: "ë¬¸ì œ8. ê·¸ë…€ëŠ” ë§¤ì¼ í•™êµì— ê°„ë‹¤.",
        a: ["she goes to school every day"]}, // ì›ë¬¸ ì˜¤íƒ€(goes go) êµì •
      { q: "ë¬¸ì œ9. ë‚˜ëŠ” ì–´ì œ í•™êµì— ê±¸ì–´ê°”ë‹¤.",
        a: ["i walked to school yesterday"]},
      { q: "ë¬¸ì œ10. ë‚˜ëŠ” ìš´ë™ì¥ì—ì„œ ë‹¬ë¦´ ê²ƒì´ë‹¤.",
        a: ["i will run on the playground"]}
    ];

    /*************** ìƒíƒœ ***************/
    let current = 0;
    let wrongCount = 0;
    let revealed = false;

    /*************** ìœ í‹¸ ***************/
    function normalize(text) {
      return text
        .trim()
        .toLowerCase()
        .replace(/[â€™']/g, "'")        // â€™, ' í†µì¼
        .replace(/\s+/g, " ")         // ë‹¤ì¤‘ ê³µë°± 1ì¹¸
        .replace(/[.!?ï¼Œã€,;:]+$/g, ""); // ëì˜ ë¬¸ì¥ë¶€í˜¸ ì œê±°
    }

    // Levenshtein ê±°ë¦¬
    function levenshtein(a, b) {
      const m = a.length, n = b.length;
      if (m === 0) return n;
      if (n === 0) return m;
      const dp = Array.from({length: m+1}, () => new Array(n+1).fill(0));
      for (let i=0;i<=m;i++) dp[i][0] = i;
      for (let j=0;j<=n;j++) dp[0][j] = j;
      for (let i=1;i<=m;i++) {
        for (let j=1;j<=n;j++) {
          const cost = a[i-1] === b[j-1] ? 0 : 1;
          dp[i][j] = Math.min(
            dp[i-1][j] + 1,     // ì‚­ì œ
            dp[i][j-1] + 1,     // ì‚½ì…
            dp[i-1][j-1] + cost // ì¹˜í™˜
          );
        }
      }
      return dp[m][n];
    }

    function prettySentence(s) {
      // í‘œì‹œìš©: ì²« ê¸€ì ëŒ€ë¬¸ì + ëì— ë§ˆì¹¨í‘œ
      const t = s.trim();
      if (!t) return s;
      const cap = t.charAt(0).toUpperCase() + t.slice(1);
      return cap.endsWith(".") ? cap : cap + ".";
    }

    function setRevealUI(show) {
      const btn = document.getElementById("revealBtn");
      btn.classList.toggle("hidden", !show);
    }

    function showAnswersList() {
      const box = document.getElementById("answersBox");
      const list = document.getElementById("answersList");
      list.innerHTML = "";
      quiz[current].a.forEach(ans => {
        const li = document.createElement("li");
        // í‘œì‹œìš©ì€ í‘œì¤€ apostropheë¡œ
        li.textContent = prettySentence(ans.replace(/[â€™]/g, "'"));
        list.appendChild(li);
      });
      box.style.display = "block";
    }

    function hideAnswersList() {
      const box = document.getElementById("answersBox");
      const list = document.getElementById("answersList");
      list.innerHTML = "";
      box.style.display = "none";
    }

    /*************** í™”ë©´ ***************/
    function showQuestion() {
      document.getElementById("question").textContent = quiz[current].q;
      document.getElementById("progress").textContent = `${current + 1} / ${quiz.length}`;
      document.getElementById("answer").value = "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("attempts").textContent = "";
      document.getElementById("answer").focus();
      wrongCount = 0;
      revealed = false;
      setRevealUI(false);
      hideAnswersList();
    }

    function checkAnswer() {
      const userRaw = document.getElementById("answer").value;
      const user = normalize(userRaw);
      const answers = quiz[current].a.map(v => normalize(v));
      const feedback = document.getElementById("feedback");
      const attempts = document.getElementById("attempts");

      // ì •í™• ì¼ì¹˜
      const exact = answers.includes(user);

      // ì˜¤íƒ€ í—ˆìš©(í¸ì§‘ê±°ë¦¬ <= FUZZY_DISTANCE)
      let fuzzyOK = false;
      if (!exact && ALLOW_FUZZY) {
        const minDist = Math.min(...answers.map(a => levenshtein(user, a)));
        fuzzyOK = (minDist <= FUZZY_DISTANCE);
      }

      if (exact || fuzzyOK) {
        feedback.textContent = exact ? "ì •ë‹µì…ë‹ˆë‹¤! ğŸ‘" : "ê±°ì˜ ì •ë‹µ! (ì˜¤íƒ€ 1ê°œë¡œ ì •ë‹µ ì²˜ë¦¬) âœ…";
        feedback.style.color = exact ? "green" : "#0a7";
        // ë‹¤ìŒ ë¬¸ì œë¡œ
        current++;
        if (current < quiz.length) {
          setTimeout(showQuestion, 900);
        } else {
          feedback.textContent = "ì¶•í•˜í•©ë‹ˆë‹¤! ëª¨ë“  ë¬¸ì œë¥¼ ë§ˆì³¤ìŠµë‹ˆë‹¤. ğŸ‰";
          attempts.textContent = "";
          setRevealUI(false);
          hideAnswersList();
        }
        return;
      }

      // ì˜¤ë‹µ ì²˜ë¦¬
      wrongCount++;
      attempts.textContent = `ì˜¤ë‹µ ${wrongCount} / ${MAX_WRONG}`;
      feedback.textContent = (wrongCount >= MAX_WRONG)
        ? "ì •ë‹µ ë³´ê¸° ë²„íŠ¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ëˆŒëŸ¬ì„œ ì •ë‹µì„ í™•ì¸í•˜ì„¸ìš”."
        : "í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.";
      feedback.style.color = "#a33";

      if (wrongCount >= MAX_WRONG) {
        setRevealUI(true);
      }
    }

    function clearInput() {
      document.getElementById("answer").value = "";
      document.getElementById("feedback").textContent = "";
      document.getElementById("answer").focus();
    }

    // ì´ë²¤íŠ¸
    document.getElementById("checkBtn").addEventListener("click", checkAnswer);
    document.getElementById("clearBtn").addEventListener("click", clearInput);
    document.getElementById("revealBtn").addEventListener("click", () => {
      revealed = true;
      showAnswersList();
      document.getElementById("feedback").textContent =
        "ì •ë‹µì„ í™•ì¸í–ˆì–´ìš”. ìœ„ í‘œí˜„ ì¤‘ í•˜ë‚˜ë¥¼ ì…ë ¥ì°½ì— ê·¸ëŒ€ë¡œ ì…ë ¥í•˜ë©´ ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.";
      document.getElementById("feedback").style.color = "#555";
      document.getElementById("answer").focus();
    });
    document.getElementById("answer").addEventListener("keydown", (e) => {
      if (e.key === "Enter") checkAnswer();
    });

    // ì‹œì‘
    showQuestion();
  </script>
</body>
</html>
